function updateCarrierList(e){var t=e.carrier_block;$("#carrier_area").replaceWith(t),bindInputs(),$("#HOOK_BEFORECARRIER").html(e.HOOK_BEFORECARRIER)}function updatePaymentMethods(e){$("#HOOK_TOP_PAYMENT").html(e.HOOK_TOP_PAYMENT),$("#opc_payment_methods-content #HOOK_PAYMENT").html(e.HOOK_PAYMENT)}function updatePaymentMethodsDisplay(){var e="";e=0!==$("#cgv:checked").length?1:0,$("#opc_payment_methods-overlay").fadeIn("slow",function(){$.ajax({type:"POST",headers:{"cache-control":"no-cache"},url:orderOpcUrl+"?rand="+(new Date).getTime(),async:!0,cache:!1,dataType:"json",data:"ajax=true&method=updateTOSStatusAndGetPayments&checked="+e+"&token="+static_token,success:function(e){updatePaymentMethods(e),"undefined"!=typeof bindUniform&&bindUniform()}}),$(this).fadeOut("slow")})}function updateAddressSelection(e){var t=1==$("#opc_id_address_delivery").length?$("#opc_id_address_delivery").val():$("#id_address_delivery").val(),o=1==$("#opc_id_address_invoice").length?$("#opc_id_address_invoice").val():1==$("#addressesAreEquals:checked").length?t:1==$("#id_address_invoice").length?$("#id_address_invoice").val():t;$("#opc_account-overlay").fadeIn("slow"),$("#opc_delivery_methods-overlay").fadeIn("slow"),$("#opc_payment_methods-overlay").fadeIn("slow"),$.ajax({type:"POST",headers:{"cache-control":"no-cache"},url:orderOpcUrl+"?rand="+(new Date).getTime(),async:!0,cache:!1,dataType:"json",data:"allow_refresh=1&ajax=true&method=updateAddressesSelected&id_address_delivery="+t+"&id_address_invoice="+o+"&token="+static_token+(e?"&isAdvApi=1":""),success:function(e){if(e.hasError){var o="";for(var n in e.errors)"indexOf"!==n&&(o+=$("<div />").html(e.errors[n]).text()+"\n");$.prototype.fancybox?$.fancybox.open([{type:"inline",autoScale:!0,minHeight:30,content:'<p class="fancybox-error">'+o+"</p>"}],{padding:0}):alert(o)}else{if(e.refresh)return void location.reload();$("#cart_summary .address_"+deliveryAddress).each(function(){if($(this).removeClass("address_"+deliveryAddress).addClass("address_"+t),$(this).attr("id",$(this).attr("id").replace(/_\d+$/,"_"+t)),$(this).find(".cart_unit ul").length>0&&$(this).find(".cart_unit ul").attr("id").length>0&&$(this).find(".cart_unit ul").attr("id",$(this).find(".cart_unit ul").attr("id").replace(/_\d+$/,"_"+t)),$(this).find(".cart_total span").length>0&&$(this).find(".cart_total span").attr("id").length>0&&$(this).find(".cart_total span").attr("id",$(this).find(".cart_total span").attr("id").replace(/_\d+$/,"_"+t)),$(this).find(".cart_quantity_input").length>0&&$(this).find(".cart_quantity_input").attr("name").length>0){var e=$(this).find(".cart_quantity_input").attr("name")+"_hidden";$(this).find(".cart_quantity_input").attr("name",$(this).find(".cart_quantity_input").attr("name").replace(/_\d+$/,"_"+t)),$(this).find('[name="'+e+'"]').length>0&&$(this).find('[name="'+e+'"]').attr("name",e.replace(/_\d+_hidden$/,"_"+t+"_hidden"))}$(this).find(".cart_quantity_delete").length>0&&$(this).find(".cart_quantity_delete").attr("id").length>0&&$(this).find(".cart_quantity_delete").attr("id",$(this).find(".cart_quantity_delete").attr("id").replace(/_\d+$/,"_"+t)).attr("href",$(this).find(".cart_quantity_delete").attr("href").replace(/id_address_delivery=\d+&/,"id_address_delivery="+t+"&")),$(this).find(".cart_quantity_down").length>0&&$(this).find(".cart_quantity_down").attr("id").length>0&&$(this).find(".cart_quantity_down").attr("id",$(this).find(".cart_quantity_down").attr("id").replace(/_\d+$/,"_"+t)).attr("href",$(this).find(".cart_quantity_down").attr("href").replace(/id_address_delivery=\d+&/,"id_address_delivery="+t+"&")),$(this).find(".cart_quantity_up").length>0&&$(this).find(".cart_quantity_up").attr("id").length>0&&$(this).find(".cart_quantity_up").attr("id",$(this).find(".cart_quantity_up").attr("id").replace(/_\d+$/,"_"+t)).attr("href",$(this).find(".cart_quantity_up").attr("href").replace(/id_address_delivery=\d+&/,"id_address_delivery="+t+"&"))}),deliveryAddress=t,void 0!==window.ajaxCart&&$(".cart_block_list dd, .cart_block_list dt").each(function(){void 0!==$(this).attr("id")&&$(this).attr("id",$(this).attr("id").replace(/_\d+$/,"_"+t))}),updateCarrierList(e.carrier_data),updatePaymentMethods(e),updateCartSummary(e.summary),updateHookShoppingCart(e.HOOK_SHOPPING_CART),updateHookShoppingCartExtra(e.HOOK_SHOPPING_CART_EXTRA),1==$("#gift-price").length&&$("#gift-price").html(e.gift_price),$("#opc_account-overlay, #opc_delivery_methods-overlay, #opc_payment_methods-overlay").fadeOut("slow")}},error:function(e,t,o){"abort"!==t&&(error="TECHNICAL ERROR: unable to save adresses \n\nDetails:\nError thrown: "+e+"\nText status: "+t,$.prototype.fancybox?$.fancybox.open([{type:"inline",autoScale:!0,minHeight:30,content:'<p class="fancybox-error">'+error+"</p>"}],{padding:0}):alert(error)),$("#opc_account-overlay, #opc_delivery_methods-overlay, #opc_payment_methods-overlay").fadeOut("slow")}})}function getCarrierListAndUpdate(){$("#opc_delivery_methods-overlay").fadeIn("slow"),$.ajax({type:"POST",headers:{"cache-control":"no-cache"},url:orderOpcUrl+"?rand="+(new Date).getTime(),async:!0,cache:!1,dataType:"json",data:"ajax=true&method=getCarrierList&token="+static_token,success:function(e){if(e.hasError){var t="";for(var o in e.errors)"indexOf"!==o&&(t+=$("<div />").html(e.errors[o]).text()+"\n");$.prototype.fancybox?$.fancybox.open([{type:"inline",autoScale:!0,minHeight:30,content:'<p class="fancybox-error">'+t+"</p>"}],{padding:0}):$.prototype.fancybox?$.fancybox.open([{type:"inline",autoScale:!0,minHeight:30,content:'<p class="fancybox-error">'+t+"</p>"}],{padding:0}):alert(t)}else updateCarrierList(e);$("#opc_delivery_methods-overlay").fadeOut("slow")}})}function updateCarrierSelectionAndGift(){var e=0,t=0,o="",n=$(".delivery_option_radio"),a="&";$.each(n,function(e){$(this).prop("checked")&&(a+=$(n[e]).attr("name")+"="+$(n[e]).val()+"&")}),"&"==a&&(a="&delivery_option=&"),$("input#recyclable:checked").length&&(e=1),$("input#gift:checked").length&&(t=1,o=encodeURIComponent($("#gift_message").val())),$("#opc_delivery_methods-overlay, #opc_payment_methods-overlay").fadeOut("slow"),$.ajax({type:"POST",headers:{"cache-control":"no-cache"},url:orderOpcUrl+"?rand="+(new Date).getTime(),async:!0,cache:!1,dataType:"json",data:"ajax=true&method=updateCarrierAndGetPayments"+a+"recyclable="+e+"&gift="+t+"&gift_message="+o+"&token="+static_token,success:function(e){if(e.hasError){var t="";for(var o in e.errors)"indexOf"!==o&&(t+=$("<div />").html(e.errors[o]).text()+"\n");$.prototype.fancybox?$.fancybox.open([{type:"inline",autoScale:!0,minHeight:30,content:'<p class="fancybox-error">'+t+"</p>"}],{padding:0}):alert(t)}else updateCartSummary(e.summary),updatePaymentMethods(e),updateHookShoppingCart(e.summary.HOOK_SHOPPING_CART),updateHookShoppingCartExtra(e.summary.HOOK_SHOPPING_CART_EXTRA),updateCarrierList(e.carrier_data),$("#opc_delivery_methods-overlay, #opc_payment_methods-overlay").fadeOut("slow"),refreshDeliveryOptions(),"undefined"!=typeof bindUniform&&bindUniform()},error:function(e,t,o){"abort"!==t&&alert("TECHNICAL ERROR: unable to save carrier \n\nDetails:\nError thrown: "+e+"\nText status: "+t),$("#opc_delivery_methods-overlay, #opc_payment_methods-overlay").fadeOut("slow")}})}function confirmFreeOrder(){0!==$("#opc_new_account-overlay").length?$("#opc_new_account-overlay").fadeIn("slow"):$("#opc_account-overlay").fadeIn("slow"),$("#opc_delivery_methods-overlay, #opc_payment_methods-overlay").fadeOut("slow"),$("#confirmOrder").prop("disabled","disabled"),$.ajax({type:"POST",headers:{"cache-control":"no-cache"},url:orderOpcUrl+"?rand="+(new Date).getTime(),async:!0,cache:!1,dataType:"html",data:"ajax=true&method=makeFreeOrder&token="+static_token,success:function(e){$("#confirmOrder").prop("disabled",!1);var t=e.split(":");"freeorder"==t[0]&&(isGuest?document.location.href=guestTrackingUrl+"?id_order="+encodeURIComponent(t[1])+"&email="+encodeURIComponent(t[2]):document.location.href=historyUrl)},error:function(e,t,o){"abort"!==t&&(error="TECHNICAL ERROR: unable to confirm the order \n\nDetails:\nError thrown: "+e+"\nText status: "+t,$.prototype.fancybox?$.fancybox.open([{type:"inline",autoScale:!0,minHeight:30,content:'<p class="fancybox-error">'+error+"</p>"}],{padding:0}):alert(error))}})}function saveAddress(e){if("delivery"!==e&&"invoice"!==e)return!1;var t="firstname="+encodeURIComponent($("#firstname"+("invoice"==e?"_invoice":"")).val())+"&lastname="+encodeURIComponent($("#lastname"+("invoice"==e?"_invoice":"")).val())+"&";$("#company"+("invoice"==e?"_invoice":"")).length&&(t+="company="+encodeURIComponent($("#company"+("invoice"==e?"_invoice":"")).val())+"&"),$("#vat_number"+("invoice"==e?"_invoice":"")).length&&(t+="vat_number="+encodeURIComponent($("#vat_number"+("invoice"==e?"_invoice":"")).val())+"&"),$("#dni"+("invoice"==e?"_invoice":"")).length&&(t+="dni="+encodeURIComponent($("#dni"+("invoice"==e?"_invoice":"")).val())+"&"),$("#address1"+("invoice"==e?"_invoice":"")).length&&(t+="address1="+encodeURIComponent($("#address1"+("invoice"==e?"_invoice":"")).val())+"&"),$("#address2"+("invoice"==e?"_invoice":"")).length&&(t+="address2="+encodeURIComponent($("#address2"+("invoice"==e?"_invoice":"")).val())+"&"),$("#postcode"+("invoice"==e?"_invoice":"")).length&&(t+="postcode="+encodeURIComponent($("#postcode"+("invoice"==e?"_invoice":"")).val())+"&"),$("#city"+("invoice"==e?"_invoice":"")).length&&(t+="city="+encodeURIComponent($("#city"+("invoice"==e?"_invoice":"")).val())+"&"),$("#id_country"+("invoice"==e?"_invoice":"")).length&&(t+="id_country="+parseInt($("#id_country"+("invoice"==e?"_invoice":"")).val())+"&"),$("#id_state"+("invoice"==e?"_invoice":"")).length&&(t+="id_state="+encodeURIComponent($("#id_state"+("invoice"==e?"_invoice":"")).val())+"&"),$("#other"+("invoice"==e?"_invoice":"")).length&&(t+="other="+encodeURIComponent($("#other"+("invoice"==e?"_invoice":"")).val())+"&"),$("#phone"+("invoice"==e?"_invoice":"")).length&&(t+="phone="+encodeURIComponent($("#phone"+("invoice"==e?"_invoice":"")).val())+"&"),$("#phone_mobile"+("invoice"==e?"_invoice":"")).length&&(t+="phone_mobile="+encodeURIComponent($("#phone_mobile"+("invoice"==e?"_invoice":"")).val())+"&"),$("#alias"+("invoice"==e?"_invoice":"")).length&&(t+="alias="+encodeURIComponent($("#alias"+("invoice"==e?"_invoice":"")).val())+"&"),"delivery"==e&&void 0!=$("#opc_id_address_delivery").val()&&parseInt($("#opc_id_address_delivery").val())>0&&(t+="opc_id_address_delivery="+parseInt($("#opc_id_address_delivery").val())+"&"),"invoice"==e&&void 0!=$("#opc_id_address_invoice").val()&&parseInt($("#opc_id_address_invoice").val())>0&&(t+="opc_id_address_invoice="+parseInt($("#opc_id_address_invoice").val())+"&"),t=t.substr(0,t.length-1);var o=!1;return $.ajax({type:"POST",headers:{"cache-control":"no-cache"},url:addressUrl+"?rand="+(new Date).getTime(),async:!1,cache:!1,dataType:"json",data:"ajax=true&submitAddress=true&type="+e+"&"+t+"&token="+static_token,success:function(e){if(e.hasError){var t="",n=0;for(var a in e.errors)"indexOf"!==a&&(n+=1,t+="<li>"+e.errors[a]+"</li>");t+="</ol>";var i="<b>"+txtThereis+" "+n+" "+txtErrors+":</b><ol>"+t;$("#opc_account_errors").slideUp("fast",function(){$(this).html(i).slideDown("slow",function(){$.scrollTo("#opc_account_errors",800)})}),$("#opc_account-overlay, #opc_delivery_methods-overlay, #opc_payment_methods-overlay").fadeOut("slow"),o=!1}else $("input#opc_id_address_delivery").val(e.id_address_delivery),$("input#opc_id_address_invoice").val(e.id_address_invoice),o=!0},error:function(e,t,o){"abort"!==t&&(error="TECHNICAL ERROR: unable to save adresses \n\nDetails:\nError thrown: "+e+"\nText status: "+t,$.prototype.fancybox?$.fancybox.open([{type:"inline",autoScale:!0,minHeight:30,content:'<p class="fancybox-error">'+error+"</p>"}],{padding:0}):alert(error)),$("#opc_account-overlay, #opc_delivery_methods-overlay, #opc_payment_methods-overlay").fadeOut("slow")}}),o}function updateNewAccountToAddressBlock(e){$("#opc_account-overlay, #opc_delivery_methods-overlay, #opc_payment_methods-overlay").fadeOut("slow"),$.ajax({type:"POST",headers:{"cache-control":"no-cache"},url:orderOpcUrl+"?rand="+(new Date).getTime(),async:!0,cache:!1,dataType:"json",data:"ajax=true&method=getAddressBlockAndCarriersAndPayments&token="+static_token+(e?"&isAdvApi=1":""),success:function(t){if(t.hasError){var o="";for(var n in t.errors)"indexOf"!==n&&(o+=$("<div />").html(t.errors[n]).text()+"\n");alert(o)}else isLogged=1,1==t.no_address&&(document.location.href=addressUrl),$("#opc_new_account").fadeOut("fast",function(){if(void 0!==t.formatedAddressFieldsValuesList&&t.formatedAddressFieldsValuesList&&(formatedAddressFieldsValuesList=t.formatedAddressFieldsValuesList),void 0!==t.order_opc_adress&&t.order_opc_adress&&$("#opc_new_account").html(t.order_opc_adress),""!==t.block_user_info&&1==$("#header_user").length){var o=$(t.block_user_info).find("#header_user_info").html();$("#header_user_info").fadeOut("normal",function(){$(this).html(o).fadeIn()})}""!==t.block_user_info_nav&&1==$(".header_user_info").length&&$(".header_user_info").fadeOut("normal",function(){$(this).html(t.block_user_info_nav).fadeIn()}),$(this).fadeIn("fast",function(){1==$("#gift-price").length&&$("#gift-price").html(t.gift_price),$.each(t.summary.products,function(){updateAddressId(this.id_product,this.id_product_attribute,"0",this.id_address_delivery)}),updateAddressesDisplay(!0),void 0!==e&&e||(updateCarrierList(t.carrier_data),updateCarrierSelectionAndGift(),updatePaymentMethods(t)),$("#opc_delivery_methods-overlay, #opc_payment_methods-overlay").fadeOut("slow")})})},error:function(e,t,o){"abort"!==t&&alert("TECHNICAL ERROR: unable to send login informations \n\nDetails:\nError thrown: "+e+"\nText status: "+t),$("#opc_delivery_methods-overlay, #opc_payment_methods-overlay").fadeOut("slow")}})}function bindInputs(){$("#message").blur(function(){$("#opc_delivery_methods-overlay").fadeIn("slow"),$.ajax({type:"POST",headers:{"cache-control":"no-cache"},url:orderOpcUrl+"?rand="+(new Date).getTime(),async:!1,cache:!1,dataType:"json",data:"ajax=true&method=updateMessage&message="+encodeURIComponent($("#message").val())+"&token="+static_token,success:function(e){if(e.hasError){var t="";for(var o in e.errors)"indexOf"!==o&&(t+=$("<div />").html(e.errors[o]).text()+"\n");alert(t)}else $("#opc_delivery_methods-overlay").fadeOut("slow")},error:function(e,t,o){"abort"!==t&&alert("TECHNICAL ERROR: unable to save message \n\nDetails:\nError thrown: "+e+"\nText status: "+t),$("#opc_delivery_methods-overlay").fadeOut("slow")}}),"undefined"!=typeof bindUniform&&bindUniform()}),$("#recyclable").on("click",function(e){updateCarrierSelectionAndGift()}),$("#gift").off("click").on("click",function(e){$("#gift").is(":checked")?$("#gift_div").show():$("#gift_div").hide(),updateCarrierSelectionAndGift()}),$("#gift").is(":checked")?$("#gift_div").show():$("#gift_div").hide(),$("#gift_message").on("change",function(){updateCarrierSelectionAndGift()}),$("#cgv").on("click",function(e){updatePaymentMethodsDisplay()})}function multishippingMode(e){$(e).prop("checked")?($("#address_delivery, .address_delivery").hide(),$("#address_delivery, .address_delivery").parent().hide(),$("#address_invoice").removeClass("alternate_item").addClass("item"),$("#multishipping_mode_box").addClass("on"),$(".addressesAreEquals").hide(),$("#address_invoice_form").show(),$(document).on("click","#link_multishipping_form",function(e){e.preventDefault()}),$(".address_add a").attr("href",addressMultishippingUrl),$(document).on("click","#link_multishipping_form",function(e){$.prototype.fancybox&&$.fancybox({openEffect:"elastic",closeEffect:"elastic",type:"ajax",href:this.href,beforeClose:function(){$.ajax({type:"POST",headers:{"cache-control":"no-cache"},url:orderOpcUrl+"?rand="+(new Date).getTime(),data:"ajax=true&method=cartReload",dataType:"html",cache:!1,success:function(e){$("#cart_summary").replaceWith($(e).find("#cart_summary")),$(".cart_quantity_input").typeWatch({highlight:!0,wait:600,captureLength:0,callback:function(e){updateQty(e,!0,this.el)}})}}),updateCarrierSelectionAndGift()},beforeLoad:function(){$.each($("#cart_summary *"),function(e,t){$(t).attr("id","")})},afterLoad:function(){$(".fancybox-inner .cart_quantity_input").typeWatch({highlight:!0,wait:600,captureLength:0,callback:function(e){updateQty(e,!1,this.el)}}),cleanSelectAddressDelivery(),$(".fancybox-outer").append($('<div class="multishipping_close_container"><a id="multishipping-close" class="btn btn-default button button-small" href="#"><span>'+CloseTxt+"</span></a></div>")),$(document).on("click","#multishipping-close",function(e){var t=0;return $(".fancybox-inner .cart_quantity_input").each(function(){t+=parseInt($(this).val())}),!(t!==totalQty&&!confirm(QtyChanged))&&($.fancybox.close(),!1)}),totalQty=0,$(".fancybox-inner .cart_quantity_input").each(function(){totalQty+=parseInt($(this).val())})}})})):($("#address_delivery, .address_delivery").show(),$("#address_invoice").removeClass("item").addClass("alternate_item"),$("#multishipping_mode_box").removeClass("on"),$(".addressesAreEquals").show(),$(".addressesAreEquals").find("input:checked").length?$("#address_invoice_form").hide():$("#address_invoice_form").show(),$(".address_add a").attr("href",addressUrl),$.ajax({type:"POST",headers:{"cache-control":"no-cache"},url:orderOpcUrl+"?rand="+(new Date).getTime(),async:!0,cache:!1,data:"ajax=true&method=noMultiAddressDelivery"}),$.ajax({type:"POST",headers:{"cache-control":"no-cache"},url:orderOpcUrl+"?rand="+(new Date).getTime(),async:!0,cache:!1,data:"ajax=true&method=cartReload",dataType:"html",success:function(e){$("#cart_summary").replaceWith($(e).find("#cart_summary"))}})),"undefined"!=typeof bindUniform&&bindUniform()}$(document).ready(function(){("undefined"==typeof isLogged||!isLogged||"undefined"!=typeof isGuest&&isGuest)&&(!guestCheckoutEnabled||isLogged||isGuest?isGuest?($(".is_customer_param").hide(),$("#opc_account_form").show("slow"),$("#is_new_customer").val("0"),$("#opc_account_choice, #opc_invoice_address").hide(),$("#new_account_title").html(txtInstantCheckout)):($("#opc_account_choice").hide(),$("#is_new_customer").val("1"),$(".is_customer_param, #opc_account_form").show(),$("#opc_invoice_address").hide()):($("#opc_account_choice").show(),$("#opc_account_form, #opc_invoice_address").hide(),$(document).on("click","#opc_createAccount",function(e){e.preventDefault(),$(".is_customer_param").show(),$("#opc_account_form").slideDown("slow"),$("#is_new_customer").val("1"),$("#opc_account_choice, #opc_invoice_address").hide(),"undefined"!=typeof bindUniform&&bindUniform()}),$(document).on("click","#opc_guestCheckout",function(e){e.preventDefault(),$(".is_customer_param").hide(),$("#opc_account_form").slideDown("slow"),$("#is_new_customer").val("0"),$("#opc_account_choice, #opc_invoice_address").hide(),$("#new_account_title").html(txtInstantCheckout),$("#submitAccount").attr({id:"submitGuestAccount",name:"submitGuestAccount"}),"undefined"!=typeof bindUniform&&bindUniform()})),$(document).on("click","#openLoginFormBlock",function(e){e.preventDefault(),$("#openNewAccountBlock").show(),$(this).hide(),$("#login_form_content").slideDown("slow"),$("#new_account_form").slideUp("slow")}),$(document).on("click","#SubmitLogin",function(e){e.preventDefault();var t=$(this);$.ajax({type:"POST",headers:{"cache-control":"no-cache"},url:authenticationUrl+"?rand="+(new Date).getTime(),async:!1,cache:!1,dataType:"json",data:"SubmitLogin=true&ajax=true&email="+encodeURIComponent($("#login_email").val())+"&passwd="+encodeURIComponent($("#login_passwd").val())+"&token="+static_token,success:function(e){if(e.hasError){var o="<b>"+txtThereis+" "+e.errors.length+" "+txtErrors+":</b><ol>";for(var n in e.errors)"indexOf"!==n&&(o+="<li>"+e.errors[n]+"</li>");o+="</ol>",$("#opc_login_errors").html(o).slideDown("slow")}else static_token=e.token,updateNewAccountToAddressBlock(t.attr("data-adv-api"))},error:function(e,t,o){"abort"!==t&&(error="TECHNICAL ERROR: unable to send login informations \n\nDetails:\nError thrown: "+e+"\nText status: "+t,$.prototype.fancybox?$.fancybox.open([{type:"inline",autoScale:!0,minHeight:30,content:'<p class="fancybox-error">'+error+"</p>"}],{padding:0}):alert(error))}})}),$(document).on("click","#submitAccount, #submitGuestAccount",function(e){e.preventDefault(),$("#opc_new_account-overlay, #opc_delivery_methods-overlay, #opc_payment_methods-overlay").fadeIn("slow");var t="",o="",n="";$(this).attr("data-adv-api")&&(o="&isAdvApi=1"),0==parseInt($("#opc_id_customer").val())?(t=authenticationUrl,n="submitAccount=true&"):(t=orderOpcUrl,n="method=editCustomer&"),$("#opc_account_form input:visible, #opc_account_form input[type=hidden]").each(function(){$(this).is("input[type=checkbox]")?$(this).is(":checked")&&(n+=encodeURIComponent($(this).attr("name"))+"=1&"):$(this).is("input[type=radio]")?$(this).is(":checked")&&(n+=encodeURIComponent($(this).attr("name"))+"="+encodeURIComponent($(this).val())+"&"):n+=encodeURIComponent($(this).attr("name"))+"="+encodeURIComponent($(this).val())+"&"}),$("#opc_account_form select:visible").each(function(){n+=encodeURIComponent($(this).attr("name"))+"="+encodeURIComponent($(this).val())+"&"}),n+="customer_lastname="+encodeURIComponent($("#customer_lastname").val())+"&",n+="customer_firstname="+encodeURIComponent($("#customer_firstname").val())+"&",n+="alias="+encodeURIComponent($("#alias").val())+"&",n+="other="+encodeURIComponent($("#other").val())+"&",n+="is_new_customer="+encodeURIComponent($("#is_new_customer").val())+"&",n=n.substr(0,n.length-1),$.ajax({type:"POST",headers:{"cache-control":"no-cache"},url:t+"?rand="+(new Date).getTime()+o,async:!1,cache:!1,dataType:"json",data:"ajax=true&"+n+"&token="+static_token,success:function(e){if(e.hasError){var t="",n=0;for(var a in e.errors)"indexOf"!==a&&(n+=1,t+="<li>"+e.errors[a]+"</li>");t+="</ol>";var i="<b>"+txtThereis+" "+n+" "+txtErrors+":</b><ol>"+t;$("#opc_account_errors").slideUp("fast",function(){$(this).html(i).slideDown("slow",function(){$.scrollTo("#opc_account_errors",800)})})}else $("#opc_account_errors").slideUp("slow",function(){$(this).html("")});if(isGuest=1==parseInt($("#is_new_customer").val())?0:1,void 0!==e.id_address_delivery&&e.id_address_delivery>0&&$("#opc_id_address_delivery").val(e.id_address_delivery),void 0!==e.id_address_invoice&&e.id_address_invoice>0&&$("#opc_id_address_invoice").val(e.id_address_invoice),void 0!==e.id_customer&&0!==e.id_customer&&e.isSaved){if(static_token=e.token,"0"!==$("#opc_id_customer").val()&&!saveAddress("delivery"))return!1;if($("#opc_id_customer").val(e.id_customer),0!==$("#invoice_address:checked").length&&!saveAddress("invoice"))return!1;$("#opc_id_customer").val(e.id_customer),isGuest?(isLogged=1,$("#opc_account_saved").fadeIn("slow"),$("#submitAccount").hide(),updateAddressSelection(o)):updateNewAccountToAddressBlock(o)}$("#opc_new_account-overlay, #opc_delivery_methods-overlay, #opc_payment_methods-overlay").fadeIn("slow")},error:function(e,t,o){"abort"!==t&&(error="TECHNICAL ERROR: unable to save account \n\nDetails:\nError thrown: "+e+"\nText status: "+t,$.prototype.fancybox?$.fancybox.open([{type:"inline",autoScale:!0,minHeight:30,content:'<p class="fancybox-error">'+error+"</p>"}],{padding:0}):alert(error)),$("#opc_new_account-overlay, #opc_delivery_methods-overlay, #opc_payment_methods-overlay").fadeIn("slow")}})})),bindInputs(),$("#opc_account_form input,select,textarea").change(function(){$(this).is(":visible")&&($("#opc_account_saved").fadeOut("slow"),$("#submitAccount").show())}),$("#multishipping_mode_checkbox").attr("checked",!1),"undefined"!=typeof multishipping_mode&&multishipping_mode&&($("#multishipping_mode_checkbox").click(),$(".addressesAreEquals").hide().find("input").attr("checked",!1)),"undefined"!=typeof open_multishipping_fancybox&&open_multishipping_fancybox&&$("#link_multishipping_form").click()});